<!DOCTYPE html>
{% load static%}
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>{% block title %} AniMagic{% endblock %}</title>
		<link rel="preconnect" href="https://fonts.googleapis.com" />
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
		<link
			href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500&display=swap"
			rel="stylesheet"
		/>
		<link rel="stylesheet" href="{% static 'css/tailwind.css' %}" />
		<link
			rel="icon"
			type="image/x-icon"
			href="{% static 'img/favicon.ico' %}"
		/>
		<script
			type="module"
			src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"
		></script>
		<script
			nomodule
			src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"
		></script>
		<script type="text/javascript">
			var user = "{{request.user}}";

			function getToken(name) {
				let cookieValue = null;
				if (document.cookie && document.cookie !== "") {
					const cookies = document.cookie.split(";");
					for (let i = 0; i < cookies.length; i++) {
						const cookie = cookies[i].trim();
						// Does this cookie string begin with the name we want?
						if (cookie.substring(0, name.length + 1) === name + "=") {
							cookieValue = decodeURIComponent(
								cookie.substring(name.length + 1)
							);
							break;
						}
					}
				}
				return cookieValue;
			}
			var csrftoken = getToken("csrftoken");

            function getCookie(name){
                //split coockie string and get all the individual name=value pairs in an array
                var cookieArr = document.cookie.split(';')

                for(var i = 0; i < cookieArr.length; i++ ){
                    var cookiePair = cookieArr[i].split('=')
                    if(name == cookiePair[0].trim()){
                        return decodeURIComponent(cookiePair[1])
                    }
                }
                return null;
            }
            var cart = JSON.parse(getCookie('cart'))
            if(cart == null){
                cart = {}
                console.log('Cart was created');
                document.cookie = 'cart=' + JSON.stringify(cart) + ";domain=;path=/"
            }
            console.log('Cart:', cart);

		</script>
	</head>
	<body class="font-[poppins]">
		<nav
			class="p-5 bg-slate-900 shadow md:flex md:items-center md:justify-between top-0 right-0 left-0 w-full z-10 fixed"
		>
			<div class="flex justify-between items-center">
				<span
					class="text-2xl text-white font-[Poppins] cursor-pointer font-medium"
				>
					<a href="/">
						<img class="h-10" src="{% static 'img/logo.png' %}" />
					</a>
				</span>

				<span class="text-3xl text-white cursor-pointer mx-2 md:hidden block">
					<ion-icon name="menu" onclick="Menu(this)"></ion-icon>
				</span>
			</div>

			<ul
				class="bg-slate-900 md:flex md:items-center md:z-auto md:static absolute w-full left-0 md:w-auto md:py-0 py-4 md:pl-0 pl-7 md:opacity-100 opacity-0 top-[-400px] transition-all ease-in duration-500"
			>
				<li class="mx-6 my-6 sm:my-0 text-xl">
					<a href="{% url 'cart' %}">
						<div class="flex items-center">
							<ion-icon
								class="text-3xl text-white hover:text-gray-300 duration-500"
								name="cart"
							></ion-icon>
							<span class="ml-1 text-white bg-red-500 p-1 rounded-lg text-xs">
								{{ cartItems }}
							</span>
						</div>
					</a>
				</li>

				<li>
					<div class="relative">
						<span
							class="text-2xl text-gray-200 cursor-pointer pr-5 pl-3 mt-2"
							id="userDropdownToggle"
						>
							<ion-icon name="person"></ion-icon>
						</span>
						<ul
							class="hidden absolute right-0 p-2 bg-slate-800 text-white rounded-lg"
							id="userDropdown"
						>
							<li class="my-2 px-3"><a href="#">name</a></li>
							<li class="my-2 px-3"><a href="#">Profile</a></li>
							<li class="my-2 px-3"><a href="#">Settings</a></li>
							<li class="my-2 px-3"><a href="#">Logout</a></li>
						</ul>
					</div>
				</li>
			</ul>
		</nav>

		{% block content %} {% endblock %}

		<footer class="bg-white mt-5 shadow dark:bg-gray-800">
			<div
				class="w-full mx-auto max-w-screen-xl p-4 md:flex md:items-center md:justify-between"
			>
				<span class="text-sm text-gray-500 sm:text-center dark:text-gray-400"
					>© 2023
					<a href="{% url 'store' %}" class="hover:underline">AniMagic™</a>. All
					Rights Reserved.
				</span>
				<ul
					class="flex flex-wrap items-center mt-3 text-sm font-medium text-gray-500 dark:text-gray-400 sm:mt-0"
				>
					<li>
						<a href="#" class="mr-4 hover:underline md:mr-6">About</a>
					</li>
					<li>
						<a href="#" class="mr-4 hover:underline md:mr-6">Privacy Policy</a>
					</li>
					<li>
						<a href="#" class="mr-4 hover:underline md:mr-6">Licensing</a>
					</li>
					<li>
						<a href="#" class="hover:underline">Contact</a>
					</li>
				</ul>
			</div>
		</footer>

		<script>
			// Get references to the toggle button and the dropdown menu
			const userDropdownToggle = document.getElementById("userDropdownToggle");
			const userDropdown = document.getElementById("userDropdown");

			// Function to toggle the visibility of the user dropdown
			function toggleUserDropdown() {
				userDropdown.classList.toggle("hidden");
			}

			// Close the user dropdown if the user clicks outside of it
			document.addEventListener("click", function (event) {
				if (
					userDropdown &&
					userDropdownToggle &&
					!userDropdownToggle.contains(event.target)
				) {
					userDropdown.classList.add("hidden");
				}
			});

			// Add a click event listener to the userDropdownToggle element
			userDropdownToggle.addEventListener("click", function (event) {
				event.stopPropagation(); // Prevent the click event from propagating to the document
				toggleUserDropdown();
			});
		</script>
		<script>
			function Menu(e) {
				let list = document.querySelector("ul");
				e.name === "menu"
					? ((e.name = "close"),
					  list.classList.add("top-[80px]"),
					  list.classList.add("opacity-100"))
					: ((e.name = "menu"),
					  list.classList.remove("top-[80px]"),
					  list.classList.remove("opacity-100"));
			}
		</script>
		<script type="text/javascript" src="{% static 'js/cart.js' %}"></script>
	</body>
</html>
